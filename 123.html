<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•æ·æ€ç¶­å°å…¥æ•™å­¸è¡Œæ”¿ | å ±åè¡¨</title>
    <!-- è¼‰å…¥ Tailwind CSS æ¡†æ¶ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ä½¿ç”¨ Noto Sans TC ä½œç‚ºä¸»è¦ä¸­æ–‡å­—é«”ï¼ŒInter ä½œç‚ºè‹±æ–‡å­—é«” */
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            /* è¨­å®šæ¼¸å±¤è‰²èƒŒæ™¯ï¼šæ´»æ½‘ã€å……æ»¿æ´»åŠ› */
            background: linear-gradient(135deg, #FF6B6B 0%, #FFD93D 50%, #4ECDC4 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 0;
        }

        /* å ±åè¡¨å®¹å™¨æ¨£å¼ */
        .form-container {
            max-width: 900px;
            width: 95%;
            background-color: rgba(255, 255, 255, 0.95); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px);
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            padding: 2.5rem;
            animation: fadeIn 1s ease-out;
        }

        /* æ¨™é¡Œå‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ´»å‹•è³‡è¨Šå€å¡Šçš„ç‰¹æ®Šæ¨£å¼ */
        .info-card {
            background: #f7f9fc;
            border-left: 5px solid #1abc9c;
            border-radius: 10px;
            padding: 1.5rem;
        }

        /* è­°ç¨‹æ™‚é–“è»¸æ¨£å¼ */
        .timeline-item {
            position: relative;
            padding-left: 2rem;
            margin-bottom: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0.25rem;
            width: 10px;
            height: 10px;
            background-color: #f39c12;
            border-radius: 50%;
            border: 2px solid #ffffff;
            box-shadow: 0 0 0 2px #1abc9c;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 4px;
            top: 1rem;
            height: 100%;
            width: 2px;
            background-color: #1abc9c;
        }

        /* æŒ‰éˆ• hover æ•ˆæœ */
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .form-container {
                padding: 1.5rem;
            }
            .timeline-item {
                padding-left: 1.5rem;
            }
            .timeline-item::after {
                height: calc(100% - 10px);
            }
        }
    </style>
</head>
<body>

    <div class="form-container">
        <!-- æ¨™é¡Œå€å¡Š -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-yellow-500 mb-2">
                æ•æ·æ€ç¶­å°å…¥æ•™å­¸è¡Œæ”¿
            </h1>
            <p class="text-xl md:text-2xl font-bold text-gray-700">
                Hello World 2025 é–‹ç™¼è€…å¤§æœƒå¿ƒå¾—åˆ†äº«æš¨å¯¦å‹™ç ”è¨æœƒ
            </p>
            <div class="mt-4 inline-block px-4 py-1 bg-teal-500 text-white font-semibold rounded-full shadow-lg">
                æå‡æ•ˆç‡ï¼Œæ“æŠ±è®ŠåŒ–ï¼
            </div>
        </header>

        <!-- æ´»å‹•è³‡è¨Šå€å¡Š -->
        <section class="mb-10 p-6 info-card">
            <h2 class="text-2xl font-bold text-teal-700 mb-3 flex items-center">
                <svg class="w-6 h-6 mr-2 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                æ´»å‹•è³‡è¨Š
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-600">
                <div>
                    <p class="font-semibold text-gray-800">æ—¥æœŸï¼š</p>
                    <p class="ml-2">2025 å¹´ 11 æœˆ 30 æ—¥ (æ—¥)</p>
                </div>
                <div>
                    <p class="font-semibold text-gray-800">æ™‚é–“ï¼š</p>
                    <p class="ml-2">14:00 - 17:00 (å…± 3 å°æ™‚)</p>
                </div>
                <div class="md:col-span-2">
                    <p class="font-semibold text-gray-800">åœ°é»ï¼š</p>
                    <p class="ml-2">ç¬¬äº”é†«ç™‚å¤§æ¨“ 5F 552 æœƒè­°å®¤</p>
                </div>
                <div class="md:col-span-2">
                    <p class="font-semibold text-gray-800">ç›®çš„ï¼š</p>
                    <p class="ml-2 text-sm leading-relaxed">åˆ†äº«ã€Œæ•æ·é–‹ç™¼ (Agile)ã€çš„æ ¸å¿ƒç²¾ç¥ï¼Œä¸¦å…±åŒæ¢è¨å¦‚ä½•å°‡å…¶æ‡‰ç”¨æ–¼æ•™å­¸éƒ¨çš„æ—¥å¸¸è¡Œæ”¿ã€å°ˆæ¡ˆç®¡ç† (å¦‚ QCCã€OSCE ç±Œå‚™) ä¸­ï¼Œä»¥æå‡åœ˜éšŠæ•ˆç‡èˆ‡æ‡‰è®Šèƒ½åŠ›ã€‚</p>
                </div>
            </div>
        </section>

        <!-- æ´»å‹•è­°ç¨‹å€å¡Š -->
        <section class="mb-10">
            <h2 class="text-3xl font-bold text-gray-800 mb-4 text-center">æ´»å‹•è­°ç¨‹ (Agenda)</h2>
            <div class="space-y-4">
                <div class="timeline-item">
                    <p class="font-bold text-lg text-red-500">14:00 - 14:15 | å ±åˆ°èˆ‡æš–èº« (Check-in)</p>
                    <p class="text-gray-600 text-sm">é ˜å–åç‰Œã€äº«ç”¨èŒ¶é»ï¼Œä¸¦é€éç°¡å–®çš„ç ´å†°éŠæˆ²èªè­˜è·¨éƒ¨é–€å¤¥ä¼´ã€‚</p>
                </div>
                <div class="timeline-item">
                    <p class="font-bold text-lg text-teal-500">14:15 - 15:00 | Session 1: æ“æŠ±è®ŠåŒ–çš„å‹‡æ°£</p>
                    <p class="text-gray-600 text-sm">å¾ Hello World 2025 é–‹ç™¼è€…å¤§æœƒçœ‹è¦‹è¶¨å‹¢ã€‚ä»€éº¼æ˜¯ Agileï¼Ÿç‚ºä»€éº¼åŸæœ¬ç”¨æ–¼è»Ÿé«”é–‹ç™¼çš„æ€ç¶­ï¼Œèƒ½è§£æ±ºè¡Œæ”¿å·¥ä½œçš„ç—›é»ï¼Ÿ</p>
                </div>
                <div class="timeline-item">
                    <p class="font-bold text-lg text-yellow-600">15:00 - 15:10 | ä¸­å ´ä¼‘æ¯ (Break)</p>
                    <p class="text-gray-600 text-sm">å¤§è…¦å……é›»èˆ‡è‡ªç”±äº¤æµæ™‚é–“ã€‚</p>
                </div>
                <div class="timeline-item">
                    <p class="font-bold text-lg text-blue-500">15:10 - 16:00 | Session 2: è¡Œæ”¿å¯¦å‹™æ‡‰ç”¨æ¡ˆä¾‹</p>
                    <p class="text-gray-600 text-sm">ä¸å†è¢« Deadline è¿½è‘—è·‘ï¼åˆ†äº«å¦‚ä½•åˆ©ç”¨ã€Œè¦–è¦ºåŒ–çœ‹æ¿ (Kanban)ã€èˆ‡ã€Œè¿­ä»£ (Iteration)ã€ä¾†å„ªåŒ– QCC å°ˆæ¡ˆèˆ‡ OSCE è€ƒè©¦ç±Œå‚™æµç¨‹ã€‚</p>
                </div>
                <div class="timeline-item">
                    <p class="font-bold text-lg text-purple-600">16:00 - 16:40 | Workshop: æ•æ·å¯¦æˆ°æ¼”ç·´</p>
                    <p class="text-gray-600 text-sm">åˆ†çµ„å·¥ä½œåŠï¼šé‡å°ç›®å‰çš„è¡Œæ”¿ç—›é»ï¼Œå¯¦éš›æ¼”ç·´ä¸€æ¬¡ã€Œç«™ç«‹æœƒè­° (Daily Stand-up)ã€èˆ‡ã€Œå›é¡§æœƒè­° (Retrospective)ã€ã€‚</p>
                </div>
                <div class="timeline-item">
                    <p class="font-bold text-lg text-green-500">16:40 - 17:00 | ç¸½çµèˆ‡å•ç­” (Q&A)</p>
                    <p class="text-gray-600 text-sm">é–‹æ”¾æå•èˆ‡è¬›å¸«ç¸½çµã€‚</p>
                </div>
            </div>
        </section>

        <!-- å ±åè¡¨å–® -->
        <section>
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center border-b-2 pb-2 border-teal-500">ç·šä¸Šå ±å</h2>
            <form id="registrationForm" onsubmit="handleRegistration(event)">
                
                <!-- åŸºæœ¬è³‡æ–™ -->
                <div class="space-y-6">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 border-l-4 pl-3 border-yellow-500">ä¸€ã€åŸºæœ¬è³‡æ–™ (å¿…å¡«)</h3>
                    
                    <!-- å§“å -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">å§“å <span class="text-red-500">*</span></label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>

                    <!-- é›»å­éƒµä»¶ (Email) -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">é›»å­éƒµä»¶ (Email) <span class="text-red-500">*</span></label>
                        <input type="email" id="email" name="email" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out">
                    </div>

                    <!-- å–®ä½ -->
                    <div>
                        <label for="unit" class="block text-sm font-medium text-gray-700">å–®ä½ <span class="text-red-500">*</span></label>
                        <input type="text" id="unit" name="unit" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="è«‹å¡«å¯«å®Œæ•´å–®ä½åç¨±">
                    </div>

                    <!-- è·ç¨± (å¿…é¸) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">è·ç¨± <span class="text-red-500">*</span></label>
                        <div class="mt-1 grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="inline-flex items-center p-3 bg-gray-100 rounded-lg shadow-inner cursor-pointer hover:bg-gray-200 transition">
                                <input type="radio" name="title" value="é†«å¸«" required class="form-radio h-4 w-4 text-teal-600">
                                <span class="ml-2 text-sm text-gray-700">é†«å¸«</span>
                            </label>
                            <label class="inline-flex items-center p-3 bg-gray-100 rounded-lg shadow-inner cursor-pointer hover:bg-gray-200 transition">
                                <input type="radio" name="title" value="è­·ç†å¸«" class="form-radio h-4 w-4 text-teal-600">
                                <span class="ml-2 text-sm text-gray-700">è­·ç†å¸«</span>
                            </label>
                            <label class="inline-flex items-center p-3 bg-gray-100 rounded-lg shadow-inner cursor-pointer hover:bg-gray-200 transition">
                                <input type="radio" name="title" value="é†«äº‹äººå“¡" class="form-radio h-4 w-4 text-teal-600">
                                <span class="ml-2 text-sm text-gray-700">é†«äº‹äººå“¡</span>
                            </label>
                            <label class="inline-flex items-center p-3 bg-gray-100 rounded-lg shadow-inner cursor-pointer hover:bg-gray-200 transition">
                                <input type="radio" name="title" value="è¡Œæ”¿äººå“¡" class="form-radio h-4 w-4 text-teal-600">
                                <span class="ml-2 text-sm text-gray-700">è¡Œæ”¿äººå“¡</span>
                            </label>
                            <label class="inline-flex items-center p-3 bg-gray-100 rounded-lg shadow-inner cursor-pointer hover:bg-gray-200 transition">
                                <input type="radio" name="title" value="å…¶ä»–" class="form-radio h-4 w-4 text-teal-600">
                                <span class="ml-2 text-sm text-gray-700">å…¶ä»–</span>
                            </label>
                        </div>
                    </div>

                    <div class="h-px bg-gray-200 my-6"></div>

                    <!-- èŒ¶æ°´é»å¿ƒ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">äºŒã€æ˜¯å¦éœ€è¦èŒ¶æ°´é»å¿ƒï¼Ÿ <span class="text-red-500">*</span></label>
                        <div class="mt-1 flex space-x-6">
                            <label class="inline-flex items-center">
                                <input type="radio" name="snacks" value="éœ€è¦" required class="form-radio h-4 w-4 text-green-600">
                                <span class="ml-2 text-sm text-gray-700">éœ€è¦</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="snacks" value="ä¸éœ€è¦" class="form-radio h-4 w-4 text-red-600">
                                <span class="ml-2 text-sm text-gray-700">ä¸éœ€è¦</span>
                            </label>
                        </div>
                    </div>

                    <div class="h-px bg-gray-200 my-6"></div>

                    <!-- æœƒå‰æå• -->
                    <div>
                        <label for="pre_question" class="block text-sm font-medium text-gray-700">ä¸‰ã€æœƒå‰æå• (é¸å¡«)</label>
                        <p class="text-xs text-gray-500 mb-1">æ‚¨ç›®å‰åœ¨è¡Œæ”¿å·¥ä½œä¸Šé‡åˆ°çš„å›°é›£ï¼Ÿæˆ–æœ€æƒ³äº†è§£é—œæ–¼ã€Œæ•æ·ã€çš„å“ªå€‹éƒ¨åˆ†ï¼Ÿ</p>
                        <textarea id="pre_question" name="pre_question" rows="4" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="è«‹åœ¨æ­¤å¡«å¯«æ‚¨çš„å•é¡Œæˆ–ç—›é»ï¼Œè®“æˆ‘å€‘æ›´å¥½åœ°æº–å‚™å…§å®¹..."></textarea>
                    </div>

                </div>

                <!-- æäº¤æŒ‰éˆ• -->
                <div class="mt-8">
                    <button type="submit" class="submit-btn w-full bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold py-3 rounded-full text-lg shadow-xl transform transition duration-300 ease-in-out">
                        ç¢ºèªé€å‡ºå ±å
                    </button>
                </div>

                <!-- éš±ç§è²æ˜èˆ‡è¯çµ¡è³‡è¨Š -->
                <div class="text-center mt-8 pt-4 border-t border-gray-200 text-sm text-gray-500">
                    <p class="mb-2">ä¸»è¾¦å–®ä½ï¼šå¥‡ç¾é†«é™¢æ•™å­¸éƒ¨</p>
                    <p>è¯çµ¡äººï¼šç›§è‹±äº‘ (åˆ†æ©Ÿ 57425)</p>
                    <p class="mt-3 text-xs text-gray-400">æœ¬å ±åè³‡æ–™åƒ…ä¾›æœ¬æ¬¡ç ”è¨æœƒè¯ç¹«èˆ‡é¤é»çµ±è¨ˆä½¿ç”¨ã€‚</p>
                </div>
            </form>
        </section>

        <!-- è‡ªè¨‚è¨Šæ¯é¡¯ç¤ºå€åŸŸ -->
        <div id="messageBox" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full">
                <p id="messageText" class="text-lg font-semibold mb-4 text-gray-800"></p>
                <button onclick="closeMessageBox()" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-full transition duration-150">
                    é—œé–‰
                </button>
            </div>
        </div>

    </div>

    <script>
        // ğŸš¨ GAS Web App ç¶²å€å·²æ›´æ–°ç‚ºæ‚¨æä¾›çš„è·¯å¾‘ ğŸš¨
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwsVBci7v4jfAQS-efgwiWulH5H54evKQk_ER8mizEd7iqNwAYyVHE_ie7WuhcjeWVYBA/exec"; 
        
        // æ¨¡æ“¬çš„ API å¯†é‘°å’Œ URL (ä¸å†ç”¨æ–¼æäº¤è¡¨å–®ï¼Œä½†ä¿ç•™ LLM ç¢ºèªè¨Šæ¯åŠŸèƒ½)
        const apiKey = ""; 
        const LLM_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // è¨Šæ¯è¦–çª—æ§åˆ¶
        function showMessageBox(message) {
            document.getElementById('messageText').innerText = message;
            document.getElementById('messageBox').classList.remove('hidden');
        }

        function closeMessageBox() {
            document.getElementById('messageBox').classList.add('hidden');
        }

        /**
         * è™•ç†è¡¨å–®æäº¤ï¼š
         * 1. é©—è­‰è³‡æ–™ã€‚
         * 2. å°‡è³‡æ–™ POST çµ¦ Apps Script Web Appã€‚
         * 3. æ ¹æ“š GAS çš„å›è¦†é¡¯ç¤ºæˆåŠŸ/å¤±æ•—è¨Šæ¯ã€‚
         */
        async function handleRegistration(event) {
            event.preventDefault(); // é˜»æ­¢è¡¨å–®é è¨­æäº¤è¡Œç‚º
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // ç¢ºä¿å¿…å¡«æ¬„ä½ä¸ç‚ºç©º
            if (!data.name || !data.email || !data.unit || !data.title || !data.snacks) {
                showMessageBox("è«‹å¡«å¯«æ‰€æœ‰æ¨™æœ‰ (*) è™Ÿçš„å¿…å¡«æ¬„ä½ï¼");
                return;
            }

            // é¡¯ç¤ºä¸€å€‹è™•ç†ä¸­çš„è¨Šæ¯
            showMessageBox("è³‡æ–™è™•ç†ä¸­ï¼Œè«‹ç¨å€™...");
            
            try {
                // å°‡ FormData è½‰æ›ç‚º URLSearchParams æ ¼å¼ (Apps Script doPost æ¥å—çš„æ ¼å¼)
                const encodedData = new URLSearchParams(formData).toString();

                // æ­¥é©Ÿ 1: å°‡è³‡æ–™ POST çµ¦ Apps Script Web App
                const gasResponse = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: encodedData
                });
                
                // Apps Script å›è¦†é€šå¸¸æ˜¯ç´”æ–‡å­—æˆ– JSON
                const gasResult = await gasResponse.json();
                
                if (gasResult.success) {
                    // æ­¥é©Ÿ 2: å¦‚æœ Apps Script å¯«å…¥æˆåŠŸï¼Œå‘¼å« LLM ç”Ÿæˆæ´»æ½‘çš„ç¢ºèªè¨Šæ¯ (å¯é¸)
                    const confirmMessage = await generateConfirmationMessage(data);

                    showMessageBox(confirmMessage);
                    // æˆåŠŸå¾Œæ¸…ç©ºè¡¨å–®
                    form.reset();
                } else {
                    // Apps Script å¯«å…¥å¤±æ•—
                    showMessageBox(`å ±åå¤±æ•—ï¼è«‹è¯ç¹«ä¸»è¾¦æ–¹ (åˆ†æ©Ÿ 57425)ã€‚éŒ¯èª¤è¨Šæ¯ï¼š${gasResult.message}`);
                }

            } catch (error) {
                console.error("Form Submission Error:", error);
                showMessageBox(`é€£ç·šæˆ–è³‡æ–™é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– Apps Script éƒ¨ç½²ç‹€æ…‹ã€‚éŒ¯èª¤ï¼š${error.message}`);
            }
        }

        /**
         * ä½¿ç”¨ LLM ç”Ÿæˆæ´»æ½‘çš„å ±åç¢ºèªè¨Šæ¯
         */
        async function generateConfirmationMessage(data) {
             const userQuery = `æˆ‘å‰›å‰›åœ¨ã€Œæ•æ·æ€ç¶­å°å…¥æ•™å­¸è¡Œæ”¿ã€ç ”è¨æœƒä¸Šæäº¤äº†å ±åã€‚è«‹æ ¹æ“šä»¥ä¸‹å ±åè³‡æ–™ï¼Œä»¥ä¸€å€‹æ´»æ½‘ã€å……æ»¿èƒ½é‡çš„è¡Œæ”¿äººå“¡å£å»ï¼Œå¯«ä¸€æ®µ 50 å­—ä»¥å…§çš„ç¢ºèªè¨Šæ¯ï¼Œå…§å®¹é ˆåŒ…å«ï¼šæ„Ÿè¬å ±åã€æåˆ°æ´»å‹•æ—¥æœŸ (11/30)ï¼Œä¸¦è¡¨ç¤ºæœŸå¾…è¦‹é¢ã€‚å ±åè€…å§“åï¼š${data.name}ï¼Œé›»å­éƒµä»¶ï¼š${data.email}ï¼Œè·ç¨±ï¼š${data.title}ã€‚`;

            try {
                const response = await fetchWithRetry(LLM_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: "ä½ æ˜¯ä¸€ä½å……æ»¿æ´»åŠ›ä¸”å‹å–„çš„ç ”è¨æœƒä¸»è¾¦æ–¹è¡Œæ”¿äººå“¡ã€‚è«‹ä½¿ç”¨ä¸­æ–‡å›æ‡‰ã€‚" }]
                        },
                    })
                });
                
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "å ±åæˆåŠŸï¼æˆ‘å€‘å·²æˆåŠŸæ”¶åˆ°æ‚¨çš„è³‡æ–™ï¼ŒæœŸå¾… 11/30 è¦‹ï¼ä¸€èµ·æ“æŠ±è®ŠåŒ–å§ï¼";

            } catch (error) {
                console.error("LLM API Call Error:", error);
                return "å ±åæˆåŠŸï¼æˆ‘å€‘å·²æˆåŠŸæ”¶åˆ°æ‚¨çš„è³‡æ–™ä¸¦å¯«å…¥ Google Sheetsï¼ŒæœŸå¾… 11/30 è¦‹ï¼";
            }
        }

        // å¸¶æœ‰æŒ‡æ•¸é€€é¿çš„ fetch å‡½æ•¸
        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        // å¦‚æœæ˜¯ 429 (Too Many Requests) æˆ–å…¶ä»–ä¼ºæœå™¨éŒ¯èª¤ï¼Œå‰‡é‡è©¦
                        if (response.status === 429 || response.status >= 500) {
                            throw new Error(`Server error: ${response.statusText}`);
                        }
                    }
                    return response; // æˆåŠŸå‰‡è¿”å›éŸ¿æ‡‰
                } catch (error) {
                    // å¦‚æœä¸æ˜¯æœ€å¾Œä¸€æ¬¡å˜—è©¦ï¼Œå‰‡ç­‰å¾…ä¸¦é‡è©¦
                    if (i < maxRetries - 1) {
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        // æœ€å¾Œä¸€æ¬¡å˜—è©¦å¤±æ•—ï¼Œæ‹‹å‡ºéŒ¯èª¤
                        throw error;
                    }
                }
            }
        }
    </script>
</body>
</html>
